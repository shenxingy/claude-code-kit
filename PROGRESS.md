# Progress Log

Hard-won insights from building and maintaining this toolkit.

---

### 2026-02-20 — Stop hook, auto-pull, sync skill improvements

**What was done:**
- `session-context.sh`: Added auto-pull at session start — fetches remote, pulls if clean, warns if dirty
- `settings-hooks.json`: Fixed Stop hook loop — added instruction to surface manual steps to user instead of retrying indefinitely
- `sync` skill: Flipped commit flag — commit is now default, `--no-commit` to skip

**What worked:**
- `git pull --ff-only` is the right default: fast-forward only, fails safely if branch has diverged

**Lessons:**
- Stop hook returning `ok=false` causes Claude to attempt auto-fix; without a "give up" instruction it loops forever on failures like missing CLI tools or interactive TUI prompts
- `drizzle-kit push` requires interactive confirmation by default; `--force` skips it — document this in project-specific PROGRESS.md when encountered
- CLI flag convention: destructive/irreversible actions opt-in (`--force`, `--delete`); common desired actions should be default with opt-out (`--no-commit`, `--dry-run`)

### 2026-02-20 — /commit skill, skill ecosystem analysis

**What was done:**
- Analyzed full skill ecosystem: identified gaps in commit workflow, PR workflow, and internal tool bidirectionality
- New `/commit` skill: groups uncommitted changes by logical module, proposes split commits for confirmation, supports `--push` and `--dry-run`
- `/sync` refactored: doc-only (TODO.md + PROGRESS.md), no longer commits — hands off to `/commit`
- Stop hook prompt improved: now instructs Claude to surface manual steps instead of looping on unresolvable failures
- `session-context.sh`: auto-pull on session start with `--ff-only` safety guard

**What worked:**
- Decoupling sync (docs) from commit (code) clarifies responsibility — `/sync` is now purely a documentation tool
- Showing the commit plan before executing gives user control without requiring manual `git add` work

**Lessons:**
- The two `/review` commands (tech debt vs PR review) are easy to confuse — they're from different sources (our command vs a plugin)
- For paper reviews, neither `/review` applies — use the `paper-reviewer` agent directly
- Skills ecosystem gaps: no `/commit` (now fixed), no PR workflow — these are the next tier of improvements

### 2026-02-20 — Housekeeping: .gitignore + wording

**What was done:**
- Added `.gitignore` to exclude `logs/` (Claude Code runtime task logs — not project artifacts)
- Minor wording cleanup in PROGRESS.md (removed stale "Company OS bidirectionality" reference)

**Lessons:**
- `logs/` is auto-generated by Claude Code's task agent system; should always be gitignored in toolkit repos

### 2026-02-20 — Stop hook JSON validation fix

**What was done:**
- Fixed recurring "Stop hook error: JSON validation failed" — root cause: model was adding prose around JSON output
- Added `RESPOND WITH ONLY VALID JSON — no preamble, no explanation, no markdown` at the top of the Stop hook prompt
- Increased Stop hook timeout from 15s → 30s (more headroom to process long conversations)
- Synced fix to both `~/.claude/settings.json` (live) and `configs/settings-hooks.json` (repo)

**What worked:**
- Leading the prompt with an explicit output-format constraint reliably suppresses prose — models respect hard constraints stated upfront more than instructions buried mid-prompt

**Lessons:**
- `type: "prompt"` hooks must output *only* JSON — any surrounding text breaks validation; always lead with the format constraint
- 15s timeout is too tight for Stop hook reviewing long conversations; 30s is safer
